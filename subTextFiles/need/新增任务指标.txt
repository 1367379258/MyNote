


新增任务指标


com.kuaishou.operation.activity.runner.indicator.mq.consumer.OperationIndicatorLiveStreamShareStatConsumer
@王庆伟 直播分享指标consumer



两个指标。
主播直播前分享


主播直播中分享


注意 ： 这两个写入redis中


然后添加两个progressStratey即可


redis key
直播前
operationActivityTest：  operation-user-activity-live-stream-user-share-count-userid-sharedid-businessid-cycleid-41


直播中分享				operation-user-activity-live-stream-user-share-count-userid-sharedid-businessid-cycleid-42

直播分享人数             operation-user-activity-live-stream-user-share-count-userid-sharedid-businessid-cycleid-23
单场直播分享人数。		  operation-user-activity-live-stream-user-share-count-userid-sharedid-businessid-cycleid-24-直播号


hgetall key 



  // 因为没有限制次数，所以不用写谁分享谁，在周期下的分享次数
  //String businessId = dto.getBusinessId();
  //long cycleId = dto.getDataKey().getCycleId();
  //String userShareCountKey = OPERATION_USER_ACTIVITY_LIVE_STREAM_USER_SHARE_COUNT
          .toKeyAppend(userId, shareUserId, businessId, cycleId, dynamicIndicatorId);
  //LOGGER.info("[IndicatorCalculateLiveStreamShareProcessor] {}  userShareCountKey = {} ", methodName, userShareCountKey);
  // 增加直播分享次数
  //operationIndicatorLiveStreamCalculateService.incrUserShareCount(userShareCountKey, dto, 1);

  sendShareNumDetailMessage(genShareNumDetailModel(context, dto));

  // 增加此指标下直播的分享次数。 此时就是获取当前用户的 redis中的数据，然后更新进度
  operationIndicatorLiveStreamCalculateService.incrIndicatorValue(context, dto, 1);
  long sumActionVale = operationIndicatorLiveStreamCalculateService.sumIndicatorValue(context, dto);
  callbackToLiveStreamProgress(context, dto, dynamicIndicatorId, sumActionVale);



operationIndicatorLiveStreamShareStatConsumer



INSERT INTO `operation_indicator` ( `indicator`, `name`, `type`, `register_count`, `can_callback`, `template_type`, `template_type_desc`, `template_type_unit`, `template_id`, `template_param`, `template_param_desc`, `template_content`, `template_pre_indicator`, `unit`, `unit_type`, `conversion`, `create_time`, `update_time`)
VALUES
	( 41, '主播直播前分享', 1, 0, 0, 0, '', '', 0, '', '', '', 0, '次', 1, 1, 1605168195000, 1608190908637),
	( 42, '主播直播中分享', 1, 0, 0, 0, '', '', 0, '', '', '', 0, '次', 1, 1, 1605168195000, 1608190908637);

INSERT INTO `operation_indicator` (, `indicator`, `name`, `register_count`, `type`, `can_callback`, `template_type`, `template_type_desc`, `template_type_unit`, `template_id`, `template_param`, `template_param_desc`, `template_content`, `template_pre_indicator`, `unit`, `unit_type`, `conversion`, `create_time`, `update_time`)
VALUES
  (41, '主播直播前分享', 1, 1, 0, 0, '', '', 0, '', '', '主播直播前分享直播到微信/朋友圈：${conditionValue}次', 0, '次', 1, 1, 1609137793598, 1609137793598),
  (42, '主播直播中分享', 1, 1, 0, 0, '', '', 0, '', '', '主播直播中分享直播到微信/朋友圈：${conditionValue}次', 0, '次', 1, 1, 1609137793598, 1609137793598);



//select * from operation_indicator_register_item where register_id = ;


//select * from operation_activity_settlement_detail where activity_id = ;

//select * from operation_activity_settlement_bill where activity_id = ;


2107168379
2148912242
operation-user-activity-indicator-2148912242-4447-1-41
icon： 产品要 给我

https://kconf.corp.kuaishou.com/#/operation/activity/indicatorCodeBasicIndicatorIdMap
  "anchorBeforeLiveStreamShare" : 41,
  "anchorMiddleLiveStreamShare" : 42,

https://kconf.corp.kuaishou.com/#/operation/activity/feIndicatorConfig
"41": {
      "2": {
        "0": {
          "desc": "主播直播前分享直播指标-主播中心渠道-未参加状态",
          "icon": "https://static.yximgs.com/udata/pkg/fe/anchor-task/share-dark.png",
          "listNameFormat": "主播直播前分享直播到微信/朋友圈${conditionValue}次",
          "infoNameFormat": "主播直播前分享直播到微信/朋友圈：${conditionValue}次",
          "indicatorDisplayName": "主播直播前分享直播到微信/朋友圈"
        }
      },
      "3": {
        "0": {
          "desc": "主播直播前分享直播指标-直播间渠道-未参加状态",
          "icon": "https://static.yximgs.com/udata/pkg/fe/anchor-task/share-light.png",
          "listNameFormat": "主播直播前分享直播到微信/朋友圈${conditionValue}次",
          "infoNameFormat": "主播直播前分享直播到微信/朋友圈：${conditionValue}次",
          "indicatorDisplayName": "主播直播前分享直播到微信/朋友圈"
        }
      },
      "4": {
        "0": {
          "desc": "主播直播前分享直播指标-关播页渠道-未参加状态",
          "icon": "https://static.yximgs.com/udata/pkg/fe/anchor-task/share-dark.png",
          "listNameFormat": "主播直播前分享直播到微信/朋友圈${conditionValue}次",
          "infoNameFormat": "主播直播前分享直播到微信/朋友圈：${conditionValue}次",
          "indicatorDisplayName": "主播直播前分享直播到微信/朋友圈"
        }
      }
    },
    "42": {
      "2": {
        "0": {
          "desc": "主播直播中分享直播指标-主播中心渠道-未参加状态",
          "icon": "https://static.yximgs.com/udata/pkg/fe/anchor-task/share-dark.png",
          "listNameFormat": "主播直播中分享直播到微信/朋友圈${conditionValue}次",
          "infoNameFormat": "主播直播中分享直播到微信/朋友圈：${conditionValue}次",
          "indicatorDisplayName": "主播直播中分享直播到微信/朋友圈"
        }
      },
      "3": {
        "0": {
          "desc": "主播直播中分享直播指标-直播间渠道-未参加状态",
          "icon": "https://static.yximgs.com/udata/pkg/fe/anchor-task/share-light.png",
          "listNameFormat": "主播直播中分享直播到微信/朋友圈${conditionValue}次",
          "infoNameFormat": "主播直播中分享直播到微信/朋友圈：${conditionValue}次",
          "indicatorDisplayName": "主播直播中分享直播到微信/朋友圈"
        }
      },
      "4": {
        "0": {
          "desc": "主播直播中分享直播指标-关播页渠道-未参加状态",
          "icon": "https://static.yximgs.com/udata/pkg/fe/anchor-task/share-dark.png",
          "listNameFormat": "主播直播中分享直播到微信/朋友圈${conditionValue}次",
          "infoNameFormat": "主播直播中分享直播到微信/朋友圈：${conditionValue}次",
          "indicatorDisplayName": "主播直播中分享直播到微信/朋友圈"
        }
      }
    },


// 主播直播中分享数量 
get operation-user-activity-live-stream-user-share-count-test-2107168379-2107168379-3693-15634-42

// 此指标下直播的分享次数







select * from operation_indicator_register where business_id = ;

select * from operation_indicator_register a join operation_indicator_register_item b on a.bussiness_id =  and a.id == b.register_id;

select * from operation_activity_settlement_bill where activity_id = ;

select * from operation_activity_settlement_bill a join operation_activity_settlement_bill_detail b  on a.activity_id =  and a.id == b.bill_id;









