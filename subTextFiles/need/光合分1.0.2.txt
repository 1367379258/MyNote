


https://light.m.kuaishou.com/light/index.html?hyId=light&layoutType=4&enableWK=1&from=msg#/ 
h5 正式环境

h5 测试环境
https://cp-h5-yumingyan.test.gifshow.com/light/?enableWK=1&layoutType=4#/home


学到什么？  加缓存， 一些从db中查询出是null，我们也放入缓存中，避免频繁访问db

先更新db，再删缓存。更新db放在业务service中，不要放入操作缓存的service中。

一定要多了解需求，没事这期是我是半介入，所以对一些不了解。
写完代码后，或者在写代码途中，或者在写之前先想好流程怎么做，先做出来，在考虑代码和性能优化。



操作redis
String key = OperationCacheKey.OPERATION_USER_DISPLAY.toKeyAppend(userId);
        int expiredTime = OperationCacheKey.OPERATION_USER_DISPLAY.getExpiredTime();
        String isDisplayStr = OperationRedisHelper.get(OperationJedisCluster.operationLight, key);
 OperationRedisHelper
                        .setex(OperationJedisCluster.operationLight, key, expiredTime,
                                String.valueOf(userGrade.getDisplayType()));

 Set<Long> userIdSet = Sets.newHashSet(userIds);
        OperationRedisHelper.pipeline(OperationJedisCluster.operationLight, userIdSet,
                (pipeline, userId) -> pipeline.del(OperationCacheKey.OPERATION_USER_DISPLAY.toKeyAppend(userId)));


开启光合分 和 在详情页展示 是否开启光合分 
光合分开启页面开发
h5 
    /rest/operation/light/permission : 判断用户是否有权限去开启光合分
	https://mock.corp.kuaishou.com/project/3721/interface/api/382508

	/rest/operation/light/score/current : 光合分以及用户信息、评价查询 
	serviceImpl中修改 displayType 也就是状态变化
	从 1 有权限首次 ->> 2 有权限多次
	https://mock.corp.kuaishou.com/project/3721/interface/api/367350

cms后台

	/rest/light/oms/author/score/author-info： 作者详情-作者信息查询
	根据displayType显示 是否开启光合分 
	https://mock.corp.kuaishou.com/project/2610/interface/api/375489

三个接口开发，自测完毕，暂无问题


1. 找到请求光合分url ，
	登陆了： 
		uid判断是否有权限   x  那个表？怎么判断 是否存在表中还是？ user_grade
		0 无权限 
		1 有权限 首次
		2 有权限 不是首次
		返回 display_type
		无权限： 展示无权限页面

		有权限： 
		1.用户点击开启，关注(不
		3.进入到了光合分主界面，此时开启完成    
		  没有进入光合分主界面，也就是动画展示中 关闭也退出。
		  表示没有开启光合分，数据库status不变。
		此时注意，我们在加载主界面的 /score/current 中要变化状态，， 查询 1 ->>> 2的变化 

已完成 


2. 在详情页展示 是否开启光合分
	https://mock.corp.kuaishou.com/mock/2610/rest/light/oms/author/score/author-info
	uid
	返回值 加一个 是否开启光合分  怎么判断是否开启
	
	注意： 可以拿到等级  (x 是外显等级还是登记 )和 作者昵称。因为
	UserCache userCache = userCacheService.getById(userId);
	OperationLightUserGrade userGradeDb = operationLightUserGradeService.getByUserId(userId);
	

问题 ： 

	加缓存 
	做生命周期： 
	        operationLightUserFeedbackService.insert(userFeedback);
        cacheService.deleteUserIsFeedback(ImmutableList.of(userId));

        OperationLightFeServiceImpl
        455
    再测一下 cms


光合 v1.0.2 - 光合分开启页面
h5 
    /rest/operation/light/permission : 判断用户是否有权限去开启光合分
	https://mock.corp.kuaishou.com/project/3721/interface/api/382508

	/rest/operation/light/score/current : 光合分以及用户信息、评价查询 
	serviceImpl中修改 displayType 也就是状态变化
	从 1 有权限首次 ->> 2 有权限多次
	https://mock.corp.kuaishou.com/project/3721/interface/api/367350

cms后台

	/rest/light/oms/author/score/author-info： 作者详情-作者信息查询
	根据displayType显示 是否开启光合分 
	https://mock.corp.kuaishou.com/project/2610/interface/api/375489

三个接口开发，自测完毕，暂无问题
	
	

上线 注意：  user_grade 加人 2107168379





